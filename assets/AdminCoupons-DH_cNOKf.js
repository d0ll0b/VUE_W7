import{A as w}from"./AlertMessages-BqGxdeYZ.js";import{M as L,D as E,P as I}from"./PaginationBtn-CKo0hPfa.js";import{_ as P,o as i,c as d,d as e,a as p,f as _,v as r,j as U,r as u,F as C,h as S,i as b,t as g,b as M}from"./index-B1NfhtV5.js";var T={VITE_APP_API_URL:"https://ec-course-api.hexschool.io/v2",VITE_APP_API_NAME:"dollob_api",BASE_URL:"/VUE_W7/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_API_URL:v,VITE_APP_API_NAME:A}=T;let h;const N={data(){return{tempCoupons:{},CouponsModal:""}},components:{AlertMessages:w},mounted(){this.CouponsModal=new L(this.$refs.CouponsModal,{keyboard:!1})},methods:{show_Modal(a,t){switch(a){case"new":this.isNew=!0,h=new Date().toISOString().split("T"),this.tempCoupons.due_date=h[0],this.CouponsModal.show();break;case"edit":this.isNew=!1,this.tempCoupons={...t},h=new Date(this.tempCoupons.due_date*1e3).toISOString().split("T"),this.tempCoupons.due_date=h[0],this.CouponsModal.show();break}},Update_Coupons(a){let t="";this.isNew===!0?(this.tempCoupons.due_date=Math.floor(new Date(this.tempCoupons.due_date)/1e3),t=`${v}/api/${A}/admin/coupon`,this.axios.post(t,{data:this.tempCoupons}).then(o=>{this.$refs.AlertMessages.show_toast("新增優惠卷成功!!!"),this.getData(),this.CouponsModal.hide()}).catch(o=>{this.tempCoupons.due_date=new Date(this.tempCoupons.due_date*1e3).toLocaleDateString(),this.$refs.AlertMessages.show_alert(o==null?void 0:o.response.data.message,1300,"error")})):(this.tempCoupons.due_date=Math.floor(new Date(this.tempCoupons.due_date)/1e3),t=`${v}//api/${A}/admin/coupon/${a}`,this.axios.put(t,{data:this.tempCoupons}).then(o=>{this.$refs.AlertMessages.show_toast("更新優惠卷成功!!!"),this.getData(),this.CouponsModal.hide()}).catch(o=>{this.tempCoupons.due_date=new Date(this.tempCoupons.due_date*1e3).toLocaleDateString(),this.$refs.AlertMessages.show_alert(o==null?void 0:o.response.data.message,1300,"error")}))},getData(){this.$emit("get_data")}}},R={id:"CouponsModal",ref:"CouponsModal",class:"modal fade text-start",tabindex:"-1","aria-labelledby":"CouponsModalLabel","aria-hidden":"true"},B={class:"modal-dialog"},O={class:"modal-content border-0"},F=e("div",{class:"modal-header bg-dark text-white"},[e("h5",{id:"CouponsModalLabel",class:"modal-title"},[e("span",null,"新增優惠卷")]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),G={class:"modal-body"},W={class:"mb-3"},j=e("label",{for:"title",class:"form-label"},"標題",-1),q={class:"mb-3"},z=e("label",{for:"title",class:"form-label"},"優惠碼",-1),H={class:"mb-3"},J=e("label",{for:"title",class:"form-label"},"到期日",-1),K={class:"mb-3"},Q=e("label",{for:"title",class:"form-label"},"折扣百分比",-1),X={class:"mb-3"},Y={class:"form-check"},Z=e("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),ee={class:"modal-footer"},te=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 關閉 ",-1);function oe(a,t,o,m,s,c){const f=u("alert-messages");return i(),d("div",R,[e("div",B,[e("div",O,[p(f,{ref:"AlertMessages"},null,512),F,e("div",G,[e("div",W,[j,_(e("input",{id:"title",type:"text",class:"form-control",placeholder:"請輸入標題","onUpdate:modelValue":t[0]||(t[0]=n=>s.tempCoupons.title=n)},null,512),[[r,s.tempCoupons.title]])]),e("div",q,[z,_(e("input",{id:"code",type:"text",class:"form-control",placeholder:"請輸入優惠碼","onUpdate:modelValue":t[1]||(t[1]=n=>s.tempCoupons.code=n)},null,512),[[r,s.tempCoupons.code]])]),e("div",H,[J,_(e("input",{id:"due_date",type:"date",class:"form-control",placeholder:"請輸入到期日","onUpdate:modelValue":t[2]||(t[2]=n=>s.tempCoupons.due_date=n)},null,512),[[r,s.tempCoupons.due_date]])]),e("div",K,[Q,_(e("input",{id:"code",type:"number",class:"form-control",placeholder:"請輸入折扣百分比","onUpdate:modelValue":t[3]||(t[3]=n=>s.tempCoupons.percent=n)},null,512),[[r,s.tempCoupons.percent,void 0,{number:!0}]])]),e("div",X,[e("div",Y,[_(e("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":t[4]||(t[4]=n=>s.tempCoupons.is_enabled=n)},null,512),[[U,s.tempCoupons.is_enabled]]),Z])])]),e("div",ee,[te,e("button",{type:"button",class:"btn btn-primary",onClick:t[5]||(t[5]=n=>c.Update_Coupons(s.tempCoupons.id))}," 新增優惠卷 ")])])])],512)}const se=P(N,[["render",oe]]);var ne={VITE_APP_API_URL:"https://ec-course-api.hexschool.io/v2",VITE_APP_API_NAME:"dollob_api",BASE_URL:"/VUE_W7/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_API_URL:$,VITE_APP_API_NAME:D}=ne,ae={data(){return{coupons:[],pagination:{},DateTime:"",isLoading:!1}},components:{CouponsModal:se,DelModal:E,AlertMessages:w,PaginationBtn:I},methods:{getCoupons(a=1){this.isLoading=!0;const t=`${$}/api/${D}/admin/coupons?page=${a}`;this.axios.get(t).then(o=>{const{coupons:m,pagination:s}=o.data;this.coupons=m,this.pagination=s}).catch(o=>{this.$refs.AlertMessages.show_alert(o==null?void 0:o.response.data.message,1300,"error")}).finally(()=>{this.isLoading=!1})},Delete_coupon(a){this.isLoading=!0;const t=`${$}/api/${D}/admin/coupon/${a}`;this.axios.delete(t).then(o=>{this.$refs.AlertMessages.show_toast("刪除優惠卷完成!!!"),this.getCoupons(),this.$refs.DelModal.hide_Modal()}).catch(o=>{this.$refs.AlertMessages.show_alert(o==null?void 0:o.response.data.message,1300,"error")}).finally(()=>{this.isLoading=!1})}},mounted(){this.getCoupons()}},le=e("h1",{class:"mt-3"},"優惠卷頁面",-1),ie={class:"container"},de={class:"mt-4"},pe={class:"text-end"},ue={class:"table align-middle"},ce=e("thead",null,[e("tr",null,[e("th",null,"名稱"),e("th",null,"折扣比率"),e("th",null,"到期日"),e("th",null,"是否啟用"),e("th",null,"編輯")])],-1),_e={class:"h5 font-weight-bold text-warning"},re={key:0,class:"text-success"},he={key:1},me={class:"btn-group btn-group-sm"},fe=["onClick"],be={key:0,class:"fas fa-spinner fa-pulse"},ge=["onClick"],Ce={key:0,class:"fas fa-spinner fa-pulse"};function Me(a,t,o,m,s,c){const f=u("VueLoading"),n=u("coupons-modal"),y=u("del-modal"),k=u("alert-messages"),V=u("pagination-btn");return i(),d(C,null,[le,p(f,{active:s.isLoading},null,8,["active"]),e("div",ie,[e("div",de,[p(n,{ref:"CouponsModal",onGet_data:c.getCoupons},null,8,["onGet_data"]),p(y,{ref:"DelModal",temp:s.coupons,onDelcoupon:c.Delete_coupon},null,8,["temp","onDelcoupon"]),p(k,{ref:"AlertMessages"},null,512),e("div",pe,[e("button",{class:"btn btn-primary",type:"button",onClick:t[0]||(t[0]=l=>this.$refs.CouponsModal.show_Modal("new"))},"新增優惠卷")]),e("table",ue,[ce,e("tbody",null,[s.coupons?(i(!0),d(C,{key:0},S(s.coupons,l=>(i(),d("tr",{key:l.id},[e("td",_e,g(l.title),1),e("td",null,g(l.percent)+" % ",1),e("td",null,g(new Date(l.due_date*1e3).toLocaleDateString()),1),e("td",null,[l.is_enabled?(i(),d("span",re,"啟用")):(i(),d("span",he,"未啟用"))]),e("td",null,[e("div",me,[e("button",{type:"button",class:"btn btn-outline-primary",onClick:x=>this.$refs.CouponsModal.show_Modal("edit",l)},[s.isLoading?(i(),d("i",be)):b("",!0),M(" 修改 ")],8,fe),e("button",{type:"button",class:"btn btn-outline-danger",onClick:x=>this.$refs.DelModal.show_Modal("coupon",l)},[s.isLoading?(i(),d("i",Ce)):b("",!0),M(" 刪除 ")],8,ge)])])]))),128)):b("",!0)])])]),p(V,{pagination:s.pagination,onChange_page:c.getCoupons},null,8,["pagination","onChange_page"])])],64)}const De=P(ae,[["render",Me]]);export{De as default};
