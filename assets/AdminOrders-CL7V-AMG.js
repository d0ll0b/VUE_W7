import{A as w}from"./AlertMessages-DUWnv966.js";import{M as L,D as E,P as V}from"./PaginationBtn-D4wIc40k.js";import{_ as k,o as i,c as r,d as t,a as _,t as l,i as y,F as p,h as A,f as v,j as x,r as u,b as C}from"./index-WHjlsYn-.js";var I={VITE_APP_API_URL:"https://ec-course-api.hexschool.io/v2",VITE_APP_API_NAME:"dollob_api",BASE_URL:"/VUE_W6/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_API_URL:O,VITE_APP_API_NAME:b}=I,S={props:["Order"],data(){return{Orders:[],tempOrder:{},isNew:!1,title:"",OrdersModal:"",isLoading:!1}},components:{AlertMessages:w},mounted(){this.OrdersModal=new L(this.$refs.OrderModal,{keyboard:!1});const o=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");this.axios.defaults.headers.common.Authorization=o,this.tempOrder={...this.Order}},methods:{getData(){this.$emit("get_data")},show_Modal(o,a){switch(o){case"new":this.isNew=!0,this.tempOrder={imagesUrl:[]},this.OrdersModal.show();break;case"edit":this.isNew=!1,this.tempOrder={...a},console.log(this.tempOrder),this.OrdersModal.show();break}},Update_Order(o){let a="";this.isNew===!0?(a=`${O}/api/${b}/admin/Order`,this.axios.post(a,{data:this.tempOrder}).then(e=>{this.$refs.AlertMessages.show_toast("新增產品成功!!!"),this.getData(),this.OrdersModal.hide()}).catch(e=>{this.$refs.AlertMessages.show_alert(e==null?void 0:e.response.data.message,1300,"error")})):(a=`${O}/api/${b}/admin/Order/${o}`,this.axios.put(a,{data:this.tempOrder}).then(e=>{this.$refs.AlertMessages.show_toast("更新產品成功!!!"),this.getData(),this.OrdersModal.hide()}).catch(e=>{this.$refs.AlertMessages.show_alert(e==null?void 0:e.response.data.message,1300,"error")}))},ShowImagebtn(o){return!Object.prototype.hasOwnProperty.call(o,"imagesUrl")&&!Array.isArray(o.imagesUrl)&&(o.imagesUrl=[],o.imagesUrl.push("")),!0},UploadImg(){let o="";o=`${O}/api/${b}/admin/upload`,this.isLoading=!0;const a=new FormData;a.append("file-to-upload",this.$refs.fileinput.files[0]),this.axios.post(o,a,{headers:{"Content-Type":"multipart/form-data"}}).then(e=>{this.tempOrder.imageUrl===""||this.tempOrder.imageUrl===void 0?this.tempOrder.imageUrl=e.data.imageUrl:this.tempOrder.imagesUrl[this.tempOrder.imagesUrl.length-1]===""?this.tempOrder.imagesUrl[this.tempOrder.imagesUrl.length-1]=e.data.imageUrl:this.tempOrder.imagesUrl.push(e.data.imageUrl),this.$refs.fileinput.value="",this.$refs.AlertMessages.show_toast("圖片上傳成功!!!")}).catch(e=>{this.$refs.AlertMessages.show_alert(e==null?void 0:e.response.data.message,1300,"error")}).finally(()=>{this.isLoading=!1})}}},N={id:"OrderModal",ref:"OrderModal",class:"modal fade text-start",tabindex:"-1","aria-labelledby":"OrderModalLabel","aria-hidden":"true"},T={class:"modal-dialog modal-xl"},R={class:"modal-content border-0"},B={class:"modal-header bg-dark text-white"},j=t("h5",{id:"OrderModalLabel",class:"modal-title"},[t("span",null,"訂單細節")],-1),F=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),q={class:"modal-body"},G={class:"row"},W={class:"col-sm-4"},z=t("h2",null,"用戶資訊",-1),H={class:"table"},J={key:0},K=t("th",null,"姓名",-1),Q=t("th",null,"Email",-1),X=t("th",null,"電話",-1),Y=t("th",null,"地址",-1),Z={class:"col-sm-8"},tt=t("h2",null,"訂單細節",-1),et={class:"table"},st=t("th",null,"訂單編號",-1),ot=t("th",null,"下單時間",-1),at=t("th",null,"付款時間",-1),lt={key:0},it={key:1},rt=t("th",null,"付款狀態",-1),nt={key:0,class:"text-success"},dt={key:1,class:"text-muted"},ht=t("th",null,"金額",-1),ct=t("hr",null,null,-1),_t=t("h2",null,"訂購品項",-1),ut={class:"table"},pt={key:0},mt={class:"text-end"},gt=t("hr",null,null,-1),ft={class:"d-flex justify-content-end"},Ot={class:"form-check form-switch"},bt={class:"form-check-label",for:"flexSwitchCheck"},Mt={key:0,class:"text-success"},$t={key:1},yt={class:"modal-footer"},At=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function wt(o,a,e,m,s,c){const g=u("alert-messages");return i(),r("div",N,[t("div",T,[t("div",R,[t("div",B,[_(g,{ref:"AlertMessages"},null,512),j,F]),t("div",q,[t("div",G,[t("div",W,[z,t("table",H,[s.tempOrder.user?(i(),r("tbody",J,[t("tr",null,[K,t("td",null,l(s.tempOrder.user.name),1)]),t("tr",null,[Q,t("td",null,l(s.tempOrder.user.email),1)]),t("tr",null,[X,t("td",null,l(s.tempOrder.user.tel),1)]),t("tr",null,[Y,t("td",null,l(s.tempOrder.user.address),1)])])):y("",!0)])]),t("div",Z,[tt,t("table",et,[t("tbody",null,[t("tr",null,[st,t("td",null,l(s.tempOrder.id),1)]),t("tr",null,[ot,t("td",null,l(new Date(s.tempOrder.create_at*1e3).toLocaleDateString()),1)]),t("tr",null,[at,t("td",null,[s.tempOrder.paid_date?(i(),r("span",lt,l(new Date(s.tempOrder.paid_date*1e3).toLocaleDateString()),1)):(i(),r("span",it,"無"))])]),t("tr",null,[rt,s.tempOrder.is_paid?(i(),r("td",nt,"完成付款")):(i(),r("td",dt,"尚未付款"))]),t("tr",null,[ht,t("td",null,l(s.tempOrder.total),1)])])]),ct,_t,t("table",ut,[s.tempOrder.products?(i(),r("tbody",pt,[(i(!0),r(p,null,A(s.tempOrder.products,(d,f)=>(i(),r("tr",{key:f},[t("td",null,l(d.product.title),1),t("td",null,l(d.qty)+"/"+l(d.product.unit),1),t("td",mt,l(d.final_total),1)]))),128))])):y("",!0)]),gt,t("div",ft,[t("div",Ot,[v(t("input",{class:"form-check-input",type:"checkbox",role:"switch",id:"flexSwitchCheck","onUpdate:modelValue":a[0]||(a[0]=d=>s.tempOrder.is_paid=d)},null,512),[[x,s.tempOrder.is_paid]]),t("label",bt,[s.tempOrder.is_paid?(i(),r("div",Mt,"完成付款")):(i(),r("div",$t,"尚未付款"))])])])])])]),t("div",yt,[At,t("button",{type:"button",class:"btn btn-primary",onClick:a[1]||(a[1]=d=>c.Update_Order(s.tempOrder.id))}," 確認 ")])])])],512)}const kt=k(S,[["render",wt]]);var vt={VITE_APP_API_URL:"https://ec-course-api.hexschool.io/v2",VITE_APP_API_NAME:"dollob_api",BASE_URL:"/VUE_W6/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_API_URL:M,VITE_APP_API_NAME:$}=vt,xt={data(){return{orders:[],pagination:{},isLoading:!1}},components:{OrdersModal:kt,DelModal:E,AlertMessages:w,PaginationBtn:V},methods:{getOrders(o=1){this.isLoading=!0;const a=`${M}/api/${$}/admin/orders?page=${o}`;this.axios.get(a).then(e=>{const{orders:m,pagination:s}=e.data;this.orders=m,this.pagination=s}).catch(e=>{this.$refs.AlertMessages.show_alert(e==null?void 0:e.response.data.message,1300,"error")}).finally(()=>{this.isLoading=!1})},Delete_order(o){this.isLoading=!0;const a=`${M}/api/${$}/admin/order/${o}`;this.axios.delete(a).then(e=>{this.$refs.AlertMessages.show_toast("刪除訂單完成!!!"),this.getOrders(),this.$refs.DelModal.hide_Modal()}).catch(e=>{this.$refs.AlertMessages.show_alert(e==null?void 0:e.response.data.message,1300,"error")}).finally(()=>{this.isLoading=!1})},Paid_Stutas(o){this.isLoading=!0;const a=`${M}/api/${$}/admin/order/${o.id}`;this.axios.put(a,{data:o}).then(e=>{this.$refs.AlertMessages.show_toast("已修改付款狀態~~"),this.getOrders()}).catch(e=>{this.$refs.AlertMessages.show_alert(e==null?void 0:e.response.data.message,1300,"error")}).finally(()=>{this.isLoading=!1})}},mounted(){this.getOrders()}},Pt=t("h1",{class:"mt-3"},"訂單頁面",-1),Ut={class:"container"},Dt={class:"mt-4"},Lt={class:"table align-middle"},Et=t("thead",null,[t("tr",null,[t("th",null,"購買日期"),t("th",null,"訂購人"),t("th",null,"購買品項(數量/單位)"),t("th",{class:"text-start"},"應付金額"),t("th",{class:"text-start"},"付款與否"),t("th",null,"編輯")])],-1),Vt=t("br",null,null,-1),Ct={class:"h6 text-start"},It={class:"text-center"},St={class:"form-check form-switch text-start"},Nt=["onUpdate:modelValue","onChange"],Tt={class:"form-check-label",for:"flexSwitchCheck"},Rt={key:0,class:"text-success"},Bt={key:1},jt={class:"btn-group btn-group-sm"},Ft=["onClick"],qt=["onClick"];function Gt(o,a,e,m,s,c){const g=u("VueLoading"),d=u("orders-modal"),f=u("del-modal"),P=u("alert-messages"),U=u("pagination-btn");return i(),r(p,null,[Pt,_(g,{active:s.isLoading},null,8,["active"]),t("div",Ut,[t("div",Dt,[_(d,{ref:"OrdersModal",onGet_data:c.getOrders},null,8,["onGet_data"]),_(f,{ref:"DelModal",onDelorder:c.Delete_order},null,8,["onDelorder"]),_(P,{ref:"AlertMessages"},null,512),t("table",Lt,[Et,t("tbody",null,[s.orders?(i(!0),r(p,{key:0},A(s.orders,n=>(i(),r("tr",{key:n.id},[t("td",null,l(new Date(n.create_at*1e3).toLocaleDateString()),1),t("td",null,l(n.user.name),1),t("td",null,[(i(!0),r(p,null,A(n.products,(h,D)=>(i(),r("div",{key:D},[C(l(h.product.title)+" 數量："+l(h.qty)+l(h.product.unit),1),Vt]))),128))]),t("td",Ct,l(n.total),1),t("td",It,[t("div",St,[v(t("input",{class:"form-check-input",type:"checkbox",role:"switch",id:"flexSwitchCheck","onUpdate:modelValue":h=>n.is_paid=h,onChange:h=>c.Paid_Stutas(n)},null,40,Nt),[[x,n.is_paid]]),t("label",Tt,[n.is_paid?(i(),r("div",Rt,"完成付款")):(i(),r("div",Bt,"尚未付款"))])])]),t("td",null,[t("div",jt,[t("button",{type:"button",class:"btn btn-outline-primary",onClick:h=>this.$refs.OrdersModal.show_Modal("edit",n)}," 檢視 ",8,Ft),t("button",{type:"button",class:"btn btn-outline-danger",onClick:h=>this.$refs.DelModal.show_Modal("order",n)}," 刪除 ",8,qt)])])]))),128)):y("",!0)])])]),_(U,{pagination:s.pagination,onChange_page:c.getOrders},null,8,["pagination","onChange_page"])])],64)}const Jt=k(xt,[["render",Gt]]);export{Jt as default};
