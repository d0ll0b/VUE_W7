import{A as x}from"./AlertMessages-DUWnv966.js";import{M as E,D as I,P as C}from"./PaginationBtn-D4wIc40k.js";import{_ as k,o as a,c as n,d as t,a as _,t as h,f as r,v as p,F as $,h as D,i as f,b,j as N,r as g}from"./index-WHjlsYn-.js";var T={VITE_APP_API_URL:"https://ec-course-api.hexschool.io/v2",VITE_APP_API_NAME:"dollob_api",BASE_URL:"/VUE_W6/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_API_URL:M,VITE_APP_API_NAME:y}=T,R={props:["product"],data(){return{products:[],tempProduct:{},isNew:!1,title:"",ProductsModal:"",isLoading:!1}},components:{AlertMessages:x},mounted(){this.ProductsModal=new E(this.$refs.productModal,{keyboard:!1});const i=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");this.axios.defaults.headers.common.Authorization=i,this.tempProduct={...this.product}},methods:{getData(){this.$emit("get_data")},show_Modal(i,s){switch(i){case"new":this.isNew=!0,this.tempProduct={imagesUrl:[]},this.ProductsModal.show();break;case"edit":this.isNew=!1,this.tempProduct={...s},this.ProductsModal.show();break}},Update_product(i){let s="";this.isNew===!0?(s=`${M}/api/${y}/admin/product`,this.axios.post(s,{data:this.tempProduct}).then(o=>{this.$refs.AlertMessages.show_toast("新增產品成功!!!"),this.getData(),this.ProductsModal.hide()}).catch(o=>{this.$refs.AlertMessages.show_alert(o==null?void 0:o.response.data.message,1300,"error")})):(s=`${M}/api/${y}/admin/product/${i}`,this.axios.put(s,{data:this.tempProduct}).then(o=>{this.$refs.AlertMessages.show_toast("更新產品成功!!!"),this.getData(),this.ProductsModal.hide()}).catch(o=>{this.$refs.AlertMessages.show_alert(o==null?void 0:o.response.data.message,1300,"error")}))},ShowImagebtn(i){return!Object.prototype.hasOwnProperty.call(i,"imagesUrl")&&!Array.isArray(i.imagesUrl)&&(i.imagesUrl=[],i.imagesUrl.push("")),!0},UploadImg(){let i="";i=`${M}/api/${y}/admin/upload`,this.isLoading=!0;const s=new FormData;s.append("file-to-upload",this.$refs.fileinput.files[0]),this.axios.post(i,s,{headers:{"Content-Type":"multipart/form-data"}}).then(o=>{this.tempProduct.imageUrl===""||this.tempProduct.imageUrl===void 0?this.tempProduct.imageUrl=o.data.imageUrl:this.tempProduct.imagesUrl[this.tempProduct.imagesUrl.length-1]===""?this.tempProduct.imagesUrl[this.tempProduct.imagesUrl.length-1]=o.data.imageUrl:this.tempProduct.imagesUrl.push(o.data.imageUrl),this.$refs.fileinput.value="",this.$refs.AlertMessages.show_toast("圖片上傳成功!!!")}).catch(o=>{this.$refs.AlertMessages.show_alert(o==null?void 0:o.response.data.message,1300,"error")}).finally(()=>{this.isLoading=!1})}}},S={id:"productModal",ref:"productModal",class:"modal fade text-start",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},B={class:"modal-dialog modal-xl"},O={class:"modal-content border-0"},F={class:"modal-header bg-dark text-white"},j={id:"productModalLabel",class:"modal-title"},z=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),G={class:"modal-body"},W={class:"row"},q={class:"col-sm-4"},H={class:"mb-2"},J={class:"mb-3"},K=t("label",{for:"imageUrl",class:"form-label text-success h5 font-weight-bold"},"主圖",-1),Q=["for"],X=["id","onUpdate:modelValue"],Y=["src"],Z={key:0},tt={class:"mb-3"},st={for:"formFile",class:"form-label"},et={key:0,class:"fas fa-spinner fa-pulse"},ot=["disabled"],lt={class:"col-sm-8"},it={class:"mb-3"},at=t("label",{for:"title",class:"form-label"},"標題",-1),nt={class:"row"},dt={class:"mb-3 col-md-6"},rt=t("label",{for:"category",class:"form-label"},"分類",-1),ct={class:"mb-3 col-md-6"},pt=t("label",{for:"price",class:"form-label"},"單位",-1),ut={class:"row"},mt={class:"mb-3 col-md-6"},ht=t("label",{for:"origin_price",class:"form-label"},"原價",-1),_t={class:"mb-3 col-md-6"},gt=t("label",{for:"price",class:"form-label"},"售價",-1),ft=t("hr",null,null,-1),bt={class:"mb-3"},Pt=t("label",{for:"description",class:"form-label"},"產品描述",-1),Ut={class:"mb-3"},vt=t("label",{for:"content",class:"form-label"},"說明內容",-1),wt={class:"mb-3"},Mt={class:"form-check"},yt=t("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),At={class:"modal-footer"},$t=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function xt(i,s,o,d,e,u){const v=g("alert-messages");return a(),n("div",S,[t("div",B,[t("div",O,[_(v,{ref:"AlertMessages"},null,512),t("div",F,[t("h5",j,[t("span",null,h(e.title)+"產品",1)]),z]),t("div",G,[t("div",W,[t("div",q,[t("div",H,[t("div",J,[K,r(t("input",{type:"text",class:"form-control",id:"imageUrl",placeholder:"請輸入圖片連結","onUpdate:modelValue":s[0]||(s[0]=l=>e.tempProduct.imageUrl=l)},null,512),[[p,e.tempProduct.imageUrl]])]),(a(!0),n($,null,D(e.tempProduct.imagesUrl,(l,m)=>(a(),n("div",{class:"mb-3",key:m},[t("label",{for:"imagesUrl_"+m,class:"form-label"},"附圖"+h(m+1),9,Q),r(t("input",{type:"text",class:"form-control",id:"imagesUrl_"+m,placeholder:"請輸入圖片連結","onUpdate:modelValue":w=>e.tempProduct.imagesUrl[m]=w},null,8,X),[[p,e.tempProduct.imagesUrl[m]]])]))),128)),t("img",{class:"img-fluid",src:e.tempProduct.imageUrl,alt:""},null,8,Y)]),u.ShowImagebtn(e.tempProduct)?(a(),n("div",Z,[t("div",tt,[t("label",st,[e.isLoading?(a(),n("i",et)):f("",!0),b(" 上傳圖片 ")]),t("input",{class:"form-control",type:"file",id:"formFile",ref:"fileinput",onChange:s[1]||(s[1]=(...l)=>u.UploadImg&&u.UploadImg(...l)),disabled:e.isLoading},null,40,ot)]),e.tempProduct.imagesUrl.length<5?(a(),n("button",{key:0,class:"btn btn-outline-primary btn-sm d-block w-100",onClick:s[2]||(s[2]=l=>{this.tempProduct.imagesUrl.push("")})}," 新增附圖 ")):f("",!0),e.tempProduct.imagesUrl.length>0?(a(),n("button",{key:1,class:"btn btn-outline-danger btn-sm d-block w-100",onClick:s[3]||(s[3]=l=>{this.tempProduct.imagesUrl.splice(-1,1)})}," 刪除附圖 ")):f("",!0)])):f("",!0)]),t("div",lt,[t("div",it,[at,r(t("input",{id:"title",type:"text",class:"form-control",placeholder:"請輸入標題","onUpdate:modelValue":s[4]||(s[4]=l=>e.tempProduct.title=l)},null,512),[[p,e.tempProduct.title]])]),t("div",nt,[t("div",dt,[rt,r(t("input",{id:"category",type:"text",class:"form-control",placeholder:"請輸入分類","onUpdate:modelValue":s[5]||(s[5]=l=>e.tempProduct.category=l)},null,512),[[p,e.tempProduct.category]])]),t("div",ct,[pt,r(t("input",{id:"unit",type:"text",class:"form-control",placeholder:"請輸入單位","onUpdate:modelValue":s[6]||(s[6]=l=>e.tempProduct.unit=l)},null,512),[[p,e.tempProduct.unit]])])]),t("div",ut,[t("div",mt,[ht,r(t("input",{id:"origin_price",type:"number",min:"0",class:"form-control",placeholder:"請輸入原價","onUpdate:modelValue":s[7]||(s[7]=l=>e.tempProduct.origin_price=l)},null,512),[[p,e.tempProduct.origin_price,void 0,{number:!0}]])]),t("div",_t,[gt,r(t("input",{id:"price",type:"number",min:"0",class:"form-control",placeholder:"請輸入售價","onUpdate:modelValue":s[8]||(s[8]=l=>e.tempProduct.price=l)},null,512),[[p,e.tempProduct.price,void 0,{number:!0}]])])]),ft,t("div",bt,[Pt,r(t("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入產品描述","onUpdate:modelValue":s[9]||(s[9]=l=>e.tempProduct.description=l)},`
                  `,512),[[p,e.tempProduct.description]])]),t("div",Ut,[vt,r(t("textarea",{id:"content",type:"text",class:"form-control",placeholder:"請輸入說明內容","onUpdate:modelValue":s[10]||(s[10]=l=>e.tempProduct.content=l)},`
                  `,512),[[p,e.tempProduct.content]])]),t("div",wt,[t("div",Mt,[r(t("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":s[11]||(s[11]=l=>e.tempProduct.is_enabled=l)},null,512),[[N,e.tempProduct.is_enabled]]),yt])])])])]),t("div",At,[$t,t("button",{type:"button",class:"btn btn-primary",onClick:s[12]||(s[12]=l=>u.Update_product(e.tempProduct.id))}," 確認 ")])])])],512)}const A=k(R,[["render",xt]]);var kt={VITE_APP_API_URL:"https://ec-course-api.hexschool.io/v2",VITE_APP_API_NAME:"dollob_api",BASE_URL:"/VUE_W6/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_API_URL:P,VITE_APP_API_NAME:U}=kt,Dt={data(){return{products:[],product:{imagesUrl:[]},isNew:!1,pagination:{},isLoading:!1}},components:{ProductsModal:A,DelModal:I,AlertMessages:x,PaginationBtn:C},methods:{getData(i=1){this.isLoading=!0;const s=`${P}/api/${U}/admin/products?page=${i}`;this.axios.get(s).then(o=>{const{products:d,pagination:e}=o.data;this.products=d,this.pagination=e}).catch(o=>{this.$refs.AlertMessages.show_alert(o==null?void 0:o.response.data.message,1300,"error")}).finally(()=>{this.isLoading=!1})},Update_product(i,s){let o="";s===!0?(o=`${P}/api/${U}/admin/product`,this.axios.post(o,{data:this.tempProduct}).then(d=>{this.$refs.AlertMessages.show_toast("新增產品成功!!!"),this.getData(),A.hide()}).catch(d=>{this.$refs.AlertMessages.show_alert(d==null?void 0:d.response.data.message,1300,"error")})):(o=`${P}/api/${U}/admin/product/${i}`,this.axios.put(o,{data:this.tempProduct}).then(d=>{this.$refs.AlertMessages.show_toast("更新產品成功!!!"),this.getData(),A.hide()}).catch(d=>{this.$refs.AlertMessages.show_alert(d==null?void 0:d.response.data.message,1300,"error")}))},Delete_product(i){let s="";s=`${P}/api/${U}/admin/product/${i}`,this.axios.delete(s).then(o=>{this.$refs.AlertMessages.show_toast("刪除產品完成!!!"),this.getData(),this.$refs.DelModal.hide_Modal()}).catch(o=>{this.$refs.AlertMessages.show_alert(o==null?void 0:o.response.data.message,1300,"error")})}},mounted(){const i=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");this.axios.defaults.headers.common.Authorization=i,this.getData()}},Vt=t("h1",{class:"mt-3"},"產品頁面",-1),Lt={class:"container"},Et={class:"row py-3"},It={class:"text-end"},Ct={class:"table table-hover mt-4"},Nt=t("thead",null,[t("tr",null,[t("th",{width:"120"}," 分類 "),t("th",null,"產品名稱"),t("th",{width:"120"}," 原價 "),t("th",{width:"120"}," 售價 "),t("th",{width:"150"}," 是否啟用 "),t("th",{width:"120"}," 編輯 ")])],-1),Tt={width:"120"},Rt={width:"150"},St={class:"h5 font-weight-bold text-warning"},Bt={width:"120"},Ot={width:"120"},Ft={width:"150"},jt={key:0,class:"text-success"},zt={key:1},Gt={class:"btn-group btn-group-sm"},Wt=["onClick"],qt={key:0,class:"fas fa-spinner fa-pulse"},Ht=["onClick"],Jt={key:0,class:"fas fa-spinner fa-pulse"};function Kt(i,s,o,d,e,u){const v=g("VueLoading"),l=g("products-modal"),m=g("del-modal"),w=g("alert-messages"),V=g("pagination-btn");return a(),n($,null,[Vt,_(v,{active:e.isLoading},null,8,["active"]),t("div",Lt,[t("div",Et,[_(l,{ref:"ProductsModal",product:e.product,onGet_data:u.getData},null,8,["product","onGet_data"]),_(m,{ref:"DelModal",temp:e.product,onDelproduct:u.Delete_product},null,8,["temp","onDelproduct"]),_(w,{ref:"AlertMessages"},null,512),t("div",It,[t("button",{class:"btn btn-primary h3",type:"button",onClick:s[0]||(s[0]=c=>this.$refs.ProductsModal.show_Modal("new"))},"新增產品")]),t("table",Ct,[Nt,t("tbody",null,[(a(!0),n($,null,D(e.products,c=>(a(),n("tr",{key:c.id},[t("td",Tt,h(c.category),1),t("td",Rt,[t("span",St,h(c.title),1)]),t("td",Bt,h(c.origin_price),1),t("td",Ot,h(c.price),1),t("td",Ft,[c.is_enabled?(a(),n("span",jt,"啟用")):(a(),n("span",zt,"未啟用"))]),t("td",null,[t("div",Gt,[t("button",{type:"button",class:"btn btn-outline-primary",onClick:L=>this.$refs.ProductsModal.show_Modal("edit",c)},[e.isLoading?(a(),n("i",qt)):f("",!0),b(" 修改 ")],8,Wt),t("button",{type:"button",class:"btn btn-outline-danger",onClick:L=>this.$refs.DelModal.show_Modal("product",c)},[e.isLoading?(a(),n("i",Jt)):f("",!0),b(" 刪除 ")],8,Ht)])])]))),128))])]),t("p",null,[b("目前有 "),t("span",null,h(e.products.length),1),b(" 項產品")])]),_(V,{pagination:e.pagination,onChange_page:u.getData},null,8,["pagination","onChange_page"])])],64)}const Zt=k(Dt,[["render",Kt]]);export{Zt as default};
